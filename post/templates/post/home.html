{% extends 'base.html' %}
{% load static %}

{% block title %}Home{% endblock %}

{% block body %}
    <!-- Slider Section (Optional) -->
    <section id="slider" class="slider section dark-background">
        <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="swiper init-swiper">
                <script type="application/json" class="swiper-config">
                    {
                        "loop": true,
                        "speed": 600,
                        "autoplay": {
                            "delay": 5000
                        },
                        "slidesPerView": "auto",
                        "centeredSlides": true,
                        "pagination": {
                            "el": ".swiper-pagination",
                            "type": "bullets",
                            "clickable": true
                        },
                        "navigation": {
                            "nextEl": ".swiper-button-next",
                            "prevEl": ".swiper-button-prev"
                        }
                    }
                </script>
                <div class="swiper-wrapper">
                    {% for post in post_list|slice:":3" %}
                        <div class="swiper-slide" style="background-image: url('{% if post.image %}{{ post.image.url }}{% else %}{% static 'img/post-slide-1.jpg' %}{% endif %}');">
                            <div class="content">
                                <h2><a href="{% url 'post:post_detail' post.slug %}">{{ post.title }}</a></h2>
                                <p>{{ post.content|truncatewords:20 }}</p>
                                <p>{{ post.user.username }}</p>
                                <p class="text-muted">
                                    {% if post.comment_post.count == 0 %}
                                        No comments yet.
                                    {% else %}
                                        Comments: {{ post.comment_post.count }}
                                    {% endif %}
                                </p>
                            </div>
                        </div>
                    {% empty %}
                        <div class="swiper-slide" style="background-image: url('{% static 'img/post-slide-1.jpg' %}');">
                            <div class="content">
                                <h2><a href="#">Welcome to My Blog</a></h2>
                                <p>Start adding posts to see them here!</p>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </section>

    <!-- Search Section -->
    {% if request.path == '/' %}
        <section class="search-section section">
            <div class="container" data-aos="fade-up">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <form method="GET" action="" class="mb-3">
                            <div class="input-group">
                                <input type="text" name="search" class="form-control" placeholder="Search posts..." value="{{ request.GET.search }}">
                                <button type="submit" class="btn btn-primary">Search</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    {% endif %}

    <!-- Posts Section -->
    <section id="trending-posts" class="trending-category section">
        <div class="container section-title" data-aos="fade-up">
            <h2>{{ title }}</h2>
        </div>
        <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="row g-5">
                <div class="col-lg-8">
                    <div class="row g-5">
                        <div class="col-lg-6 border-start custom-border">
                            {% for post in post_list %}
                                <div class="post-entry">
                                    <a href="{% url 'post:post_detail' post.slug %}">
                                        {% if post.image %}
                                            <img src="{{ post.image.url }}" alt="" class="img-fluid">
                                        {% else %}
                                            <img src="{% static 'img/default-post.jpg' %}" alt="" class="img-fluid">
                                        {% endif %}
                                    </a>
                                    <div class="post-meta">
                                        <span class="date">{{ post.category.name|default:"Uncategorized" }}</span>
                                        <span class="mx-1">â€¢</span>
                                        <span>{{ post.created_at|date:"M dS Y" }}</span>
                                    </div>
                                    <h2><a href="{% url 'post:post_detail' post.slug %}">{{ post.title }}</a></h2>
                                    <p>{{ post.content|truncatewords:20 }}</p>
                                    <p class="text-muted">
                                        {% if post.comment_post.count == 0 %}
                                            No comments yet.
                                        {% else %}
                                            Comments: {{ post.comment_post.count }}
                                        {% endif %}
                                    </p>
                                </div>
                            {% empty %}
                                <p>No posts available.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="trending">
                        <h3>Actions</h3>
                        <ul class="trending-post">
                            <li>
                                <a href="{% url 'post:add_post' %}">
                                    <span class="number">1</span>
                                    <h3>Add a New Post</h3>
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'post:contact' %}">
                                    <span class="number">2</span>
                                    <h3>Contact Us</h3>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}